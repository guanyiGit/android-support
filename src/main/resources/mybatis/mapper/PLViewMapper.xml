<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.soholy.mapper.PLViewDb">

    <!--查看平台列表-->
    <select id="findVersionList" resultType="com.soholy.pojo.VersionRefPl">
        SELECT
            v.creation_time,v.make,v.pk_url,v.platform_id,v.version_info,v.v_seq,
            p.addr,p.ip_info,p.pl_name,p.pl_seq,p.creation_time plCreationTime
        FROM t_version_info v
        LEFT JOIN t_platfrom p ON p.pl_seq = v.platform_id
        <where>
            <if test="plSeq != null">
                AND p.pl_seq = #{plSeq}
            </if>
            <if test="page != null and page.keyWord != null">
                AND (
                p.addr LIKE CONCAT('%',#{page.keyWord},'%') OR
                p.ip_info LIKE CONCAT('%',#{page.keyWord},'%')
                )
            </if>
            <if test="make != null">
                AND v.make = #{make}
            </if>
        </where>
        ORDER BY v.version_info DESC, v.creation_time DESC
        <if test="page != null">
            LIMIT #{page.offset} , #{page.limit}
        </if>

    </select>

    <!--查看平台列表 count -->
    <select id="findVersionListCount" resultType="int">
        SELECT
            count(1)
        FROM t_version_info v
        LEFT JOIN t_platfrom p ON p.pl_seq = v.platform_id
        <where>
            <if test="plSeq != null">
                AND p.pl_seq = #{plSeq}
            </if>
            <if test="page != null and page.keyWord != null">
                AND (
                p.addr LIKE CONCAT('%',#{page.keyWord},'%') OR
                p.ip_info LIKE CONCAT('%',#{page.keyWord},'%')
                )
            </if>
            <if test="make != null">
                AND v.make = #{make}
            </if>
        </where>
    </select>



    <!--查询平台版本信息 -->
    <select id="findPlVersion" resultType="com.soholy.pojo.VersionRefPl">
        SELECT
            v.creation_time,v.make,v.pk_url,v.platform_id,v.version_info,v.v_seq,
            p.addr,p.ip_info,p.pl_name,p.pl_seq,p.creation_time plCreationTime
        FROM t_version_info v
        INNER JOIN t_platfrom p ON v.platform_id = p.pl_seq
        <where>
            <if test="version != null">
                v.version_info = #{version}
            </if>
            <if test="checkType == 1">
                AND p.pl_seq = #{platform}
            </if>
            <if test="checkType == 2">
                AND p.pl_name = #{platform}
            </if>
            AND v.make = 1
        </where>
        ORDER BY v.creation_time DESC
    </select>

</mapper>
